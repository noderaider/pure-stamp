<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../">
  <title data-ice="title">lib/index.js | API Document</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  
  
  <script src="script/manual.js"></script>
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <a data-ice="repoURL" href="https://github.com/noderaider/pure-stamp" class="repo-url-github">Repository</a>
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-pureStamp">pureStamp</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">desc</div><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-profile">profile</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">lib/index.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">import reactStamp from &apos;react-stamp&apos;
import profiler from &apos;./desc/profiler&apos;

const CONNECT_KEY = &apos;connect&apos;

const freezeValue = value =&gt; ({ value, enumerable: true, writable: false, configurable: false })

/**
 * Creates an optimized pure compose function with dependencies tacked onto it for easy lib propagation.
 * @param  {Object}         options.React           React dependency.
 * @param  {Object}         options.shallowCompare  React shallowCompare add-on dependency.
 * @param  {Array&lt;Object&gt;}  options.deps            Optional dependencies to propagate.
 * @param  {Object}         defaults                Optional configuration object to propagate.
 * @return {function}                                 pure compose function with propagated dependencies and defaults.
 */
export default function pureStamp({ React, shallowCompare, ...deps } = {}, defaults = {}) {
  const { PropTypes, cloneElement } = React
  const { compose } = reactStamp(React)

  const HAS_CONNECT = Object.keys(deps).includes(CONNECT_KEY)

  const pure = Object.entries({ React
                              , PropTypes
                              , cloneElement
                              , ...deps
                              , defaults
                              , impure: compose
                              , profiler
                              , destructure: () =&gt; [ { React, shallowCompare, ...deps }, defaults ]
                              })
    .reduce ( ( pure, [ depName, dep ]) =&gt; Object.defineProperty( pure
                                                                , depName
                                                                , freezeValue(dep)
                                                                )
            , function pure (...desc) {
                let mapState
                let mapDispatch
                let merge
                let options

                /** Strips mapState, mapDispatch, mergeProps, and options from any &apos;connect&apos; keys on description object. */
                function stripConnect (reactDesc) {
                  return Object.entries(reactDesc).reduce((reduced, [ key, value ]) =&gt; {
                    /** If key is not connect key, pass the prop along. */
                    if(key !== CONNECT_KEY)
                      return { ...reduced, [key]: value }

                    /** key is connect key, strip and compose each of the present connect functions */
                    const { mapStateToProps, mapDispatchToProps, mergeProps } = value

                    let lastMapState = mapState
                    let lastMapDispatch = mapDispatch
                    let lastMerge = merge

                    if(mapStateToProps) {
                      if(mapStateToProps.length === 1 &amp;&amp; (!mapState || mapState.length === 1))
                        mapState = state =&gt; ({ ...(lastMapState ? lastMapState(state) : {}), ...mapStateToProps(state) })
                      else
                        mapState = (...args) =&gt; ({ ...(lastMapState ? lastMapState(...args) : {}), ...mapStateToProps(...args) })
                    }
                    if(mapDispatchToProps) {
                      if(mapDispatchToProps.length === 1 &amp;&amp; (!mapDispatch || mapDispatch.length === 1))
                        mapDispatch = dispatch =&gt; ({ ...(lastMapDispatch ? lastMapDispatch(dispatch) : {}), ...mapDispatchToProps(dispatch) })
                      else
                        mapDispatch = (...args) =&gt; ({ ...(lastMapDispatch ? lastMapDispatch(...args) : {}), ...mapDispatchToProps(...args) })
                    }
                    if(mergeProps)
                      merge = (...args) =&gt; ({ ...(lastMerge ? lastMerge(...args) : {}), ...mergeProps(...args) })
                    if(value.options)
                      options = { ...(options || {}), ...value.options }
                    return reduced
                  }, {})
                }

                const Stamp = compose(
                  { displayName: &apos;PureComponent&apos;
                  , shouldComponentUpdate(nextProps, nextState) {
                      return shallowCompare(this, nextProps, nextState)
                    }
                  }
                    /** If redux connect dep passed and connect key detected, will strip out their mapStateToProps and mapDispatchToProps and apply them automatically. */
                  , ...(HAS_CONNECT ? desc.map(stripConnect) : desc)
                )

                const useConnect = HAS_CONNECT &amp;&amp; (mapState || mapDispatch || merge)
                return useConnect ? deps.connect(mapState, mapDispatch, merge, options)(Stamp)
                                  : Stamp
              }
            )
  return Object.freeze(pure)
}
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(0.4.7)</span></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
